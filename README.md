# C++ - 从零实现 Json-RPC 框架

## 🎯 项目概述

### 目标
基于 **C++**、**JsonCpp**、**muduo网络库**，实现一个功能完整的 **JSON-RPC 通信框架**，支持：

- ✅ **RPC 调用**（同步/异步/回调）
- ✅ **服务注册与发现**
- ✅ **发布订阅模式**
- ✅ **分布式架构支持**

### RPC 核心思想
像调用本地方法一样调用远程方法，隐藏底层网络通信细节。

## 🛠️ 技术选型

| 模块 | 技术方案 | 说明 |
|------|----------|------|
| 网络通信 | muduo | 主从Reactor模型，高性能异步网络库 |
| 序列化 | JSON（JsonCpp） | 跨语言、易读写的序列化格式 |
| 通信协议 | LV格式 | Length + Value，解决粘包问题 |
| 异步支持 | C++11标准库 | `std::future`/`std::promise`/`std::packaged_task` |

## 🏗️ 系统架构

### 服务端模块设计

| 模块 | 职责 |
|------|------|
| **Network** | 基于 muduo 的网络通信 |
| **Protocol** | LV 协议解析，解决粘包问题 |
| **Dispatcher** | 消息类型分发 |
| **RpcRouter** | RPC 方法路由与参数校验 |
| **Publish-Subscribe** | 主题管理与消息推送 |
| **Registry-Discovery** | 服务注册、发现、上下线通知 |
| **Server** | 整合各模块的服务入口 |

### 客户端模块设计

| 模块 | 职责 |
|------|------|
| **Requestor** | 请求管理与响应匹配（支持异步） |
| **RpcCaller** | RPC 调用接口（同步/异步/回调） |
| **Publish-Subscribe** | 主题操作与消息处理 |
| **Registry-Discovery** | 服务发现与主机管理 |
| **Client** | 整合各模块的客户端入口 |

## 📡 核心功能

### 1. RPC 调用机制
支持三种调用方式：
- **同步调用**：阻塞等待结果返回
- **异步调用**：返回 future 对象
- **回调调用**：设置回调函数处理结果

### 2. 服务注册与发现
- 服务提供者向注册中心注册服务
- 服务消费者从注册中心发现服务
- 支持服务上下线动态通知

### 3. 发布订阅模式
- 主题的创建、删除、订阅、取消订阅
- 消息的发布与推送
- 多客户端消息广播

### 4. 通信协议设计
采用 LV（Length + Value）格式：
```
+----------+----------+-----------+--------+--------+
|  Length  |  MType   |  IDLength |   ID   |  Body  |
|  (4字节) |  (4字节) |   (4字节) |        |        |
+----------+----------+-----------+--------+--------+
```

## 📊 项目特点

### ✅ 功能完备
- 完整的 RPC 调用机制
- 服务治理能力（注册、发现、通知）
- 发布订阅消息模式
- 异步通信支持

### ✅ 架构清晰
- 模块化设计，职责分离
- 抽象层与具象层分离，易于扩展
- 支持插件式模块替换

### ✅ 高性能
- 基于 muduo 的高并发网络库
- 异步 IO 操作
- 连接复用机制

### ✅ 易用性
- 简洁的 API 设计
- 多种调用方式满足不同场景
- 完整的示例和文档